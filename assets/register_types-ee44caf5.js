import{serializable as c,Text as X,Canvas as it,CanvasGroup as k,Behaviour as A,GameObject as j,Button as Z,getWorldPosition as D,getWorldQuaternion as L,setWorldQuaternion as $,getWorldScale as J,Mathf as v,getTempVector as G,InstantiateOptions as ot,OrbitControls as K,MeshRenderer as nt,getBoundingBox as at,TypeStore as R,Animator as rt,getParam as lt,setWorldPosition as q,SceneSwitcher as ct,Image as ht}from"./needle-engine-0ae70549.js";import{O as U,V as b,M as tt,Q as et,S as pt,R as dt}from"./three.module-155196c6.js";import"./index-cbae2585.js";var mt=Object.defineProperty,ut=Object.getOwnPropertyDescriptor,u=(h,e,s,o)=>{for(var i=o>1?void 0:o?ut(e,s):e,l=h.length-1,r;l>=0;l--)(r=h[l])&&(i=(o?r(e,s,i):r(i))||i);return o&&i&&mt(e,s,i),i};class E extends A{constructor(){super(...arguments),this.titleText="Title",this.contentText="Content",this.viewAngle=40,this.correlatedGameObject=null,this.instance=null}start(){var s;const e=new ot;e.parent=this.gameObject,this.instance=j.instantiate(S.Instance.hotspotTemplate.gameObject,e),this.instance?(this.instance.removeFromParent(),this.gameObject.add(this.instance),this.hotspot=(s=this.instance)==null?void 0:s.getComponent(y),this.hotspot&&(j.setActive(this.hotspot.gameObject,!0),this.hotspot.init(this),S.Instance.registerHotspot(this.hotspot))):console.error("No hotspot template assigned to HotspotManager!")}destroy(){this.instance&&(j.destroy(this.instance),this.instance=null,this.hotspot=null)}}u([c()],E.prototype,"titleText",2);u([c()],E.prototype,"contentText",2);u([c()],E.prototype,"viewAngle",2);u([c(U)],E.prototype,"correlatedGameObject",2);class y extends A{constructor(){super(...arguments),this.cullDistance=10,this.selected=!1,this.contentFadeTimestamp=-999,this.isVisible=!1,this.hotspotFadeTimestamp=-999,this.button=null}init(e){var s,o;this.hotspot=e,this.label&&(this.label.text=e.titleText),this.content&&(this.content.text=e.contentText),this.button=this.gameObject.getComponentInChildren(Z),(o=(s=this.button)==null?void 0:s.onClick)==null||o.addEventListener(this.onButtonClicked.bind(this)),this.gameObject.name=e.titleText}onButtonClicked(){this.selected=!this.selected,this.contentFadeTimestamp=this.context.time.time,this.selected&&S.Instance&&S.Instance.onSelect(this)}deselect(){this.selected&&(this.contentFadeTimestamp=this.context.time.time,this.selected=!1)}onBeforeRender(e){if(!this.hotspot||!this.gameObject.parent)return;const s=this.context.mainCamera;if(s==null)return;if(this.context.isInXR){const t=D(s);if(this.gameObject.lookAt(t),this.context.xrSession.interactionMode==="screen-space"){const W=t.sub(this.forward);this.gameObject.lookAt(W)}}else{const t=L(s);$(this.gameObject,t)}const o=J(s),l=D(this.gameObject).clone().clone();s.worldToLocal(l);const r=-1*l.z*o.x,m=v.clamp(s.fov,0,70),d=.25*Math.tan(m*v.Deg2Rad/2)*r;this.gameObject.scale.set(d,d,d);const f=this.hotspot.gameObject.getWorldDirection(G()),a=this.hotspot.worldPosition,P=s.getWorldPosition(G()),w=G(P).sub(a).normalize(),T=v.toDegrees(f.angleTo(w));var n;r<this.cullDistance?n=T<this.hotspot.viewAngle:n=!1,n!=this.isVisible&&(this.hotspotFadeTimestamp=this.context.time.time,this.button&&(this.button.enabled=n),!n&&this.selected&&(this.selected=!1,this.contentFadeTimestamp=this.context.time.time)),this.isVisible=n,this.applyFade()}applyFade(){var m,p;const e=this.isVisible?1:0,s=v.clamp01((this.context.time.time-this.hotspotFadeTimestamp)/this.hotspotFadeDuration),o=v.lerp(1-e,e,s),i=this.selected?1:0,l=v.clamp01((this.context.time.time-this.contentFadeTimestamp)/this.contentFadeDuration),r=v.lerp(1-i,i,l);this.contentCanvasGroup&&(((m=this.content)==null?void 0:m.text)==""?(this.contentCanvasGroup.alpha=0,this.contentCanvasGroup.interactable=!1):(this.contentCanvasGroup.alpha=Math.min(o,r),this.contentCanvasGroup.interactable=this.selected)),this.headerCanvasGroup&&(((p=this.label)==null?void 0:p.text)==""?(this.headerCanvasGroup.alpha=0,this.headerCanvasGroup.interactable=!1):(this.headerCanvasGroup.alpha=o,this.headerCanvasGroup.interactable=this.isVisible))}getCorrelatedObject(){var e;return(e=this.hotspot)==null?void 0:e.correlatedGameObject}}u([c(X)],y.prototype,"label",2);u([c(X)],y.prototype,"content",2);u([c()],y.prototype,"contentFadeDuration",2);u([c()],y.prototype,"hotspotFadeDuration",2);u([c(it)],y.prototype,"canvas",2);u([c(k)],y.prototype,"contentCanvasGroup",2);u([c(k)],y.prototype,"headerCanvasGroup",2);u([c()],y.prototype,"cullDistance",2);const st=class extends A{constructor(){super(...arguments),this.forceSingleActive=!0,this.shouldRecenterOnSelect=!0,this.cullDistance=10,this.activeHotspots=[],this.orbitControls=j.findObjectOfType(K)}awake(){st.Instance=this,this.hotspotTemplate.gameObject.position.set(0,0,0),this.hotspotTemplate.gameObject.scale.set(1,1,1),this.hotspotTemplate.gameObject.quaternion.identity(),this.hotspotTemplate.gameObject.removeFromParent(),j.setActive(this.hotspotTemplate.gameObject,!1)}registerHotspot(h){this.activeHotspots.indexOf(h)===-1&&this.activeHotspots.push(h)}onSelect(h){if(!this.forceSingleActive)return;for(const s of this.activeHotspots)s!==h&&s&&s.deselect();const e=h.getCorrelatedObject();this.orbitControls&&this.shouldRecenterOnSelect&&e&&(this.orbitControls.setLookTargetPosition(e,1),this.orbitControls.setCameraTargetPosition(this.calculateCameraTargetPosition(e,h),1))}calculateCameraTargetPosition(h,e){var m;var s=new b,o=0;const i=(m=this.orbitControls)==null?void 0:m.controllerObject;if(h.getComponent(nt)){const p=new Array(0);p.push(h);const d=new b,f=new b,a=at(p,void 0);i.updateMatrixWorld(),i.updateProjectionMatrix(),a.getCenter(f);const P=new b;a.getSize(P),a.applyMatrix4(i.matrixWorldInverse),a.getSize(d),a.setFromCenterAndSize(f,d);const w=i.fov,T=2*Math.atan(Math.tan(w*Math.PI/360/2)*i.aspect)/Math.PI*360,n=d.y/(2*Math.atan(Math.PI*w/360)),t=d.x/(2*Math.atan(Math.PI*T/360));o=Math.max(n,t)+d.z/2}else o=1;const l=i.getWorldPosition(i.position).clone(),r=G(l.sub(e.worldPosition).normalize());return s=e.worldPosition.add(r.multiplyScalar(o)),s}};let S=st;u([c(y)],S.prototype,"hotspotTemplate",2);u([c()],S.prototype,"forceSingleActive",2);u([c()],S.prototype,"shouldRecenterOnSelect",2);u([c()],S.prototype,"cullDistance",2);R.add("Hotspot",E);R.add("HotspotBehaviour",y);R.add("HotspotManager",S);const Y=new b,ft=new et,Q=new b;class bt extends U{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(s){s.element instanceof Element&&s.element.parentNode!==null&&s.element.parentNode.removeChild(s.element)})})}copy(e,s){return super.copy(e,s),this.element=e.element.cloneNode(!0),this}}const O=new tt,gt=new tt;class vt{constructor(e={}){const s=this;let o,i,l,r;const m={camera:{style:""},objects:new WeakMap},p=e.element!==void 0?e.element:document.createElement("div");p.style.overflow="hidden",this.domElement=p;const d=document.createElement("div");d.style.transformOrigin="0 0",d.style.pointerEvents="none",p.appendChild(d);const f=document.createElement("div");f.style.transformStyle="preserve-3d",d.appendChild(f),this.getSize=function(){return{width:o,height:i}},this.render=function(n,t){const g=t.projectionMatrix.elements[5]*r;t.view&&t.view.enabled?(d.style.transform=`translate( ${-t.view.offsetX*(o/t.view.width)}px, ${-t.view.offsetY*(i/t.view.height)}px )`,d.style.transform+=`scale( ${t.view.fullWidth/t.view.width}, ${t.view.fullHeight/t.view.height} )`):d.style.transform="",n.matrixWorldAutoUpdate===!0&&n.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld();let W,C;t.isOrthographicCamera&&(W=-(t.right+t.left)/2,C=(t.top+t.bottom)/2);const x=t.view&&t.view.enabled?t.view.height/t.view.fullHeight:1,z=t.isOrthographicCamera?`scale( ${x} )scale(`+g+")translate("+a(W)+"px,"+a(C)+"px)"+P(t.matrixWorldInverse):`scale( ${x} )translateZ(`+g+"px)"+P(t.matrixWorldInverse),I=(t.isPerspectiveCamera?"perspective("+g+"px) ":"")+z+"translate("+l+"px,"+r+"px)";m.camera.style!==I&&(f.style.transform=I,m.camera.style=I),T(n,n,t)},this.setSize=function(n,t){o=n,i=t,l=o/2,r=i/2,p.style.width=n+"px",p.style.height=t+"px",d.style.width=n+"px",d.style.height=t+"px",f.style.width=n+"px",f.style.height=t+"px"};function a(n){return Math.abs(n)<1e-10?0:n}function P(n){const t=n.elements;return"matrix3d("+a(t[0])+","+a(-t[1])+","+a(t[2])+","+a(t[3])+","+a(t[4])+","+a(-t[5])+","+a(t[6])+","+a(t[7])+","+a(t[8])+","+a(-t[9])+","+a(t[10])+","+a(t[11])+","+a(t[12])+","+a(-t[13])+","+a(t[14])+","+a(t[15])+")"}function w(n){const t=n.elements;return"translate(-50%,-50%)"+("matrix3d("+a(t[0])+","+a(t[1])+","+a(t[2])+","+a(t[3])+","+a(-t[4])+","+a(-t[5])+","+a(-t[6])+","+a(-t[7])+","+a(t[8])+","+a(t[9])+","+a(t[10])+","+a(t[11])+","+a(t[12])+","+a(t[13])+","+a(t[14])+","+a(t[15])+")")}function T(n,t,g,W){if(n.isCSS3DObject){const C=n.visible===!0&&n.layers.test(g.layers)===!0;if(n.element.style.display=C===!0?"":"none",C===!0){n.onBeforeRender(s,t,g);let x;n.isCSS3DSprite?(O.copy(g.matrixWorldInverse),O.transpose(),n.rotation2D!==0&&O.multiply(gt.makeRotationZ(n.rotation2D)),n.matrixWorld.decompose(Y,ft,Q),O.setPosition(Y),O.scale(Q),O.elements[3]=0,O.elements[7]=0,O.elements[11]=0,O.elements[15]=1,x=w(O)):x=w(n.matrixWorld);const z=n.element,B=m.objects.get(n);if(B===void 0||B.style!==x){z.style.transform=x;const I={style:x};m.objects.set(n,I)}z.parentNode!==f&&f.appendChild(z),n.onAfterRender(s,t,g)}}for(let C=0,x=n.children.length;C<x;C++)T(n.children[C],t,g)}}}var yt=Object.defineProperty,xt=Object.getOwnPropertyDescriptor,_=(h,e,s,o)=>{for(var i=o>1?void 0:o?xt(e,s):e,l=h.length-1,r;l>=0;l--)(r=h[l])&&(i=(o?r(e,s,i):r(i))||i);return o&&i&&yt(e,s,i),i};class M extends A{constructor(){super(...arguments),this.url="https://www.youtube.com/embed/puWNRrG4MCg",this.pixelsPerUnit=500,this.borderRadius=50,this.animator=null,this.title="",this.isYoutubeVideo=!1,this.mute=!1,this.rotate90=new et().setFromAxisAngle(new b(0,1,0),Math.PI),this.camPos=new b}start(){const e=lt("url");e&&(this.url=e);const s=document.createElement("div");s.innerHTML='<iframe width="1000" height="1000" style="volume: silent" title="'+this.title+'" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; xr-spatial-tracking; xr"  allowfullscreen></iframe>',s.style.position="absolute",s.style.pointerEvents="initial";const o=s.querySelector("iframe");if(o.addEventListener("load",()=>{setTimeout(()=>{var d;(d=this.animator)==null||d.SetBool("Open",!0)},1e3)}),this.isYoutubeVideo){var i=this.mute?1:0;o.src=this.url+"&mute="+i}else o.src=this.url;let l=1e3;const r=Math.round(this.gameObject.scale.x*this.pixelsPerUnit),m=Math.round(this.gameObject.scale.y*this.pixelsPerUnit);l=Math.max(r,m),o.width=r+"px",o.height=m+"px",s.style.position="absolute",this.borderRadius>0&&(s.style.borderRadius=this.borderRadius+"px"),s.style.pointerEvents="initial",document.body.append(s),this.cssRenderer=new vt,this.cssRenderer.domElement.style.pointerEvents="none",this.cssRenderer.domElement.style.position="absolute",this.cssRenderer.domElement.style.top="0px",document.body.append(this.cssRenderer.domElement),this.cssScene=new pt;const p=new bt(s);p.scale.setScalar(Math.max(this.gameObject.scale.x,this.gameObject.scale.y)/l),q(p,D(this.gameObject)),$(p,L(this.gameObject)),p.quaternion.multiply(this.rotate90),this.cssScene.add(p),this.cssObj=p,this.context.post_render_callbacks.push(this.onPostRender.bind(this))}onPostRender(){var p,d;if(!this.cssObj||!this.cssRenderer||!this.cssScene)return;q(this.cssObj,D(this.gameObject)),$(this.cssObj,L(this.gameObject)),this.cssObj.quaternion.multiply(this.rotate90);const e=this.context.mainCamera,s=this.gameObject;var o=e.position.clone().sub(s.position).normalize(),i=s.getWorldDirection(new b);const l=o.dot(i);var r=(p=this.camPos)==null?void 0:p.distanceTo(e.position);if(r!=null&&r>.001)if((d=this.camPos)==null||d.copy(e.position),l<0){const f=D(s),P=D(e).clone().sub(f).normalize(),w=new dt(f,P),T=e.getWorldPosition(e.position).distanceTo(this.gameObject.worldPosition),n=this.context.physics.raycastFromRay(w,{maxDistance:T*.9});this.cssObj.visible=n.length==0}else this.cssObj.visible=!1;const m=this.cssRenderer.getSize();(m.width!==this.context.domWidth||m.height!==this.context.domHeight)&&this.cssRenderer.setSize(this.context.domWidth,this.context.domHeight),this.cssRenderer.render(this.cssScene,this.context.mainCamera)}openURL(){window.open(this.url)}}_([c()],M.prototype,"url",2);_([c()],M.prototype,"pixelsPerUnit",2);_([c()],M.prototype,"borderRadius",2);_([c(rt)],M.prototype,"animator",2);_([c()],M.prototype,"title",2);_([c()],M.prototype,"isYoutubeVideo",2);_([c()],M.prototype,"mute",2);var Ot=Object.defineProperty,wt=Object.getOwnPropertyDescriptor,N=(h,e,s,o)=>{for(var i=o>1?void 0:o?wt(e,s):e,l=h.length-1,r;l>=0;l--)(r=h[l])&&(i=(o?r(e,s,i):r(i))||i);return o&&i&&Ot(e,s,i),i};class V extends A{constructor(){super(...arguments),this.rightClickToFocus=!0,this.startLookAtTarget=null,this.lookAtDirection=new b(0,0,0),this.needleOrbitControls=null}start(){var o,i;if(this.needleOrbitControls=j.findObjectOfType(K),this.startLookAtTarget){var e=this.startLookAtTarget.getWorldPosition(this.startLookAtTarget.position.clone());(o=this.needleOrbitControls)==null||o.setCameraTargetPosition(e.add(this.lookAtDirection),!0)}const s=new Array;s.push(this.startLookAtTarget),(i=this.needleOrbitControls)==null||i.fitCamera(s,{immediate:!0})}onBeforeRender(){if(this.rightClickToFocus&&this.context.input.getPointerClicked(2)){const e=this.context.physics.raycast();if(e&&this.needleOrbitControls){for(const s of e)if(s.distance>0&&j.isActiveInHierarchy(s.object)){this.needleOrbitControls.setLookTargetPosition(s.point);break}}}}}N([c()],V.prototype,"rightClickToFocus",2);N([c(U)],V.prototype,"startLookAtTarget",2);N([c(b)],V.prototype,"lookAtDirection",2);var Ct=Object.defineProperty,St=Object.getOwnPropertyDescriptor,H=(h,e,s,o)=>{for(var i=o>1?void 0:o?St(e,s):e,l=h.length-1,r;l>=0;l--)(r=h[l])&&(i=(o?r(e,s,i):r(i))||i);return o&&i&&Ct(e,s,i),i};class F extends A{constructor(){super(...arguments),this.sceneToSwitch=0,this.minSize=.003,this.maxSize=.008,this.cullDistance=50,this.sceneManager=null,this.initialScale=new b,this.isVisible=!1,this.fadeTimestamp=-999,this.button=null,this.buttonImage=null,this.canvas=null}start(){var e,s,o;this.sceneManager=j.findObjectOfType(ct),this.initialScale=this.gameObject.scale.clone(),this.button=this.gameObject.getComponentInChildren(Z),this.button&&(this.buttonImage=(e=this.button)==null?void 0:e.gameObject.getComponent(ht)),this.canvas=this.gameObject.getComponent(k),(o=(s=this.button)==null?void 0:s.onClick)==null||o.addEventListener(this.switchScene.bind(this))}onBeforeRender(){const e=this.context.mainCamera;if(e==null)return;const s=J(e),i=D(this.gameObject).clone().clone();e.worldToLocal(i);const l=-1*i.z*s.x,r=v.clamp(e.fov,0,70),m=.1*Math.tan(r*v.Deg2Rad/2),p=this.initialScale.clone().multiplyScalar(m).multiplyScalar(l);p.clampLength(this.minSize,this.maxSize),this.gameObject.scale.set(p.x,p.y,p.z),l<this.cullDistance!=this.isVisible&&(this.fadeTimestamp=this.context.time.time),this.applyFade()}applyFade(){const e=this.isVisible?1:0,s=v.clamp01((this.context.time.time-this.fadeTimestamp)/this.fadeDuration),o=v.lerp(1-e,e,s);this.canvas&&(this.canvas.alpha=o),this.button&&(this.button.interactable=o!=0),this.buttonImage&&this.buttonImage.setAlphaFactor(o)}switchScene(){if(this.sceneManager){var e=this.sceneManager.scenes[this.sceneToSwitch];this.sceneManager.switchScene(e)}}}H([c()],F.prototype,"sceneToSwitch",2);H([c()],F.prototype,"minSize",2);H([c()],F.prototype,"maxSize",2);H([c()],F.prototype,"cullDistance",2);H([c()],F.prototype,"fadeDuration",2);R.add("IFrame",M);R.add("OrbitControlsExtension",V);R.add("SceneSwitchButton",F);
